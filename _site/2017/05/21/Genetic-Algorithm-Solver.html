  <html>
  <head>
  <!-- _includes/base.html -->



    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

    <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.min.css">
    <link rel="stylesheet" href="/stylesheets/styles.css">
    <link rel="stylesheet" href="/stylesheets/pygment_trac.css"> 
    <link rel="stylesheet" href="/stylesheets/syntax.css"> 
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <link href='http://fonts.googleapis.com/css?family=Indie+Flower' rel='stylesheet' type='text/css'>
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head> 

  </html>

      <body>
<div class="wrapper">
    <header>
        <h1>Profiling Evolutionary Algorithm Solver</h1>
        </br>
        <p class="view"><a href="https://github.com/KevinFasusi">View My GitHub Profile</a></p>

        <p class="view">
            <!-- Twitter -->
            <a class="btn btn-twitter" href="https://twitter.com/Kevin_Fasusi"><i class="fa fa-twitter"></i> Twitter</a><br/>
            <!-- LinkedIn -->
            <a class="btn btn-linkedin" href="https://t.co/vVIDg5IH6m"><i class="fa fa-linkedin"></i> LinkedIn</a><br/>
            <!-- Googleplus -->
            <a class="btn btn-googleplus" href="https://plus.google.com/u/0/+KevinFasusi/posts"><i
                    class="fa fa-google-plus"></i> Google+</a>
            <br/>
            <a rel="stylesheet" type="text/css" href="/">Blog</a>
            <br/>
            <a rel="stylesheet" type="text/css" href="about/"> About</a>

        </p>

    </header>
    <section>

        <html>
  <head>
  <!-- _includes/base.html -->



    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

    <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.min.css">
    <link rel="stylesheet" href="/stylesheets/styles.css">
    <link rel="stylesheet" href="/stylesheets/pygment_trac.css"> 
    <link rel="stylesheet" href="/stylesheets/syntax.css"> 
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <link href='http://fonts.googleapis.com/css?family=Indie+Flower' rel='stylesheet' type='text/css'>
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head> 

  </html>

        <p>The first forecasting techniques implemented in supplychainpy were, “simple” and “holt’s trend corrected” exponential smoothing. I wanted to get a sense of whether the optimisation using the genetic algorithm (GA) solver, was working. <!--more --></p>

<p>The goal of the GA solver is to find a “good enough” smoothing constant, resulting in the smallest value possible for the sum of standard errors. When searching for a minimum value, there is a risk that the result is a local minimum.</p>

<p>To explore whether, the current solver is finding an acceptable or “good enough” constant, I ran the <code class="highlighter-rouge">simple_exponential_smoothing_forecast()</code> 50 times using random alpha values, between zero and one, with the optimisation flag set to <code class="highlighter-rouge">optimise=false</code>. The default setting for the GA are <code class="highlighter-rouge">initial_population=100,  recombination_type='single_point', mutation_probability=0.2</code> (currently these are fixed in the library within the population class <a href="https://github.com/KevinFasusi/supplychainpy/blob/master/supplychainpy/demand/_evo_algo.pyx">here</a> and are not exposed to the public API).</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">multiprocessing</span> <span class="kn">as</span> <span class="nn">mp</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">rcParams</span><span class="p">,</span> <span class="n">cm</span>
<span class="kn">import</span> <span class="nn">random</span> 
<span class="kn">from</span> <span class="nn">supplychainpy.model_demand</span> <span class="kn">import</span> <span class="n">simple_exponential_smoothing_forecast</span>
<span class="n">rcParams</span><span class="p">[</span><span class="s">'figure.figsize'</span><span class="p">]</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span><span class="mi">5</span>
<span class="n">cores</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">mp</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">())</span> <span class="o">-</span> <span class="mi">1</span>
<span class="n">orders</span> <span class="o">=</span> <span class="p">[</span><span class="mi">165</span><span class="p">,</span> <span class="mi">171</span><span class="p">,</span> <span class="mi">147</span><span class="p">,</span> <span class="mi">143</span><span class="p">,</span> <span class="mi">164</span><span class="p">,</span> <span class="mi">160</span><span class="p">,</span> <span class="mi">152</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">159</span><span class="p">,</span> <span class="mi">169</span><span class="p">,</span> <span class="mi">173</span><span class="p">,</span> <span class="mi">203</span><span class="p">,</span> <span class="mi">169</span><span class="p">,</span> <span class="mi">166</span><span class="p">,</span> <span class="mi">162</span><span class="p">,</span> <span class="mi">147</span><span class="p">,</span> <span class="mi">188</span><span class="p">,</span> <span class="mi">161</span><span class="p">,</span> <span class="mi">162</span><span class="p">,</span>
          <span class="mi">169</span><span class="p">,</span> <span class="mi">185</span><span class="p">,</span> <span class="mi">188</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">229</span><span class="p">,</span> <span class="mi">189</span><span class="p">,</span> <span class="mi">218</span><span class="p">,</span> <span class="mi">185</span><span class="p">,</span> <span class="mi">199</span><span class="p">,</span> <span class="mi">210</span><span class="p">,</span> <span class="mi">193</span><span class="p">,</span> <span class="mi">211</span><span class="p">,</span> <span class="mi">208</span><span class="p">,</span> <span class="mi">216</span><span class="p">,</span> <span class="mi">218</span><span class="p">,</span> <span class="mi">264</span><span class="p">,</span> <span class="mi">304</span><span class="p">]</span>
<span class="n">ses_alpha</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">ses_standard_error</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">maximum</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">rnd_nums</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="mi">4</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">maximum</span><span class="p">)]</span>
<span class="k">with</span> <span class="n">mp</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="n">processes</span> <span class="o">=</span><span class="n">cores</span><span class="p">)</span> <span class="k">as</span> <span class="n">pool</span><span class="p">:</span>
    <span class="n">ses_forecast</span> <span class="o">=</span> <span class="p">[</span><span class="n">pool</span><span class="o">.</span><span class="n">apply_async</span><span class="p">(</span><span class="n">simple_exponential_smoothing_forecast</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">orders</span><span class="p">,</span> <span class="n">rnd_nums</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="bp">False</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">maximum</span><span class="p">)]</span>
    <span class="n">ses_results</span> <span class="o">=</span> <span class="p">[</span><span class="n">forecast</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="k">for</span> <span class="n">forecast</span> <span class="ow">in</span> <span class="n">ses_forecast</span><span class="p">]</span>
    <span class="n">ses_alpha</span> <span class="o">=</span> <span class="p">[</span><span class="n">results</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'optimal_alpha'</span><span class="p">)</span> <span class="k">for</span> <span class="n">results</span> <span class="ow">in</span> <span class="n">ses_results</span><span class="p">]</span>
    <span class="n">ses_standard_error</span> <span class="o">=</span> <span class="p">[</span><span class="n">results</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'standard_error'</span><span class="p">)</span> <span class="k">for</span> <span class="n">results</span> <span class="ow">in</span> <span class="n">ses_results</span><span class="p">]</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">ses_alpha</span><span class="p">,</span> <span class="n">ses_standard_error</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">'alpha'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">'standard error'</span><span class="p">)</span></code></pre></figure>

<p>The plot below shows the result for the random alpha values.</p>

<p><img src="/assets/ses_rnd.png" alt="ses forecast" title="solution space" /></p>

<p>Running the example 50 times is not enough to get an adequate view of the possible results obtained without using the solver. Unfortunately, the current implementation for <code class="highlighter-rouge">simple_exponential_smoothing</code> (<a href="https://github.com/KevinFasusi/supplychainpy/blob/master/supplychainpy/demand/_forecast_demand.py">here</a>) uses a generator to ‘yield’ the results. The <a href="https://github.com/KevinFasusi/supplychainpy/blob/master/supplychainpy/model_demand.py">public API</a> in the module (<code class="highlighter-rouge">from supplychainpy.model_demand import simple_exponential_smoothing_forecast</code>), constantly calls the function that relies on the generator. In an attempt to increase the speed of the computation, a processing pool from the <code class="highlighter-rouge">multiprocessing</code> module in the Python standard library is used. Unfortunately, the use of a ‘pool’ causes the process sometimes to hang and remain uncompleted. After using the logging function, it seems that the generator function is called an ungodly amount of times.</p>

<p>I have tried implementing this as a batch job but have been unsuccessful. I guess I have to rewrite the forecast implementation and remove the generators. At least, I hope that is the solution. Honestly, this problem has been giving me the middle finger for a while.</p>

<p>The simple exponential smoothing forecast was run again (50 times), this time using the optimisation solver. The resulting scatter graph shows the results group around a minimum value.</p>

<p><img src="/assets/ses_standard_err_alpha2.png" alt="ses forecast" title="solution space" /></p>

<p>The solver seems to be finding a value that is close to the minimum. A similar process was followed for random alpha and gamma values using <code class="highlighter-rouge">holts_trend_corrected_exponential_smoothing_forecast()</code>.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">multiprocessing</span> <span class="kn">as</span> <span class="nn">mp</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>

<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">rcParams</span><span class="p">,</span> <span class="n">cm</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="kn">import</span> <span class="n">Axes3D</span>

<span class="kn">from</span> <span class="nn">supplychainpy.model_demand</span> <span class="kn">import</span> <span class="n">holts_trend_corrected_exponential_smoothing_forecast</span>

<span class="n">rcParams</span><span class="p">[</span><span class="s">'figure.figsize'</span><span class="p">]</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span><span class="mi">5</span>
<span class="n">cores</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">mp</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">())</span> <span class="o">-</span> <span class="mi">1</span>
<span class="n">orders</span> <span class="o">=</span> <span class="p">[</span><span class="mi">165</span><span class="p">,</span> <span class="mi">171</span><span class="p">,</span> <span class="mi">147</span><span class="p">,</span> <span class="mi">143</span><span class="p">,</span> <span class="mi">164</span><span class="p">,</span> <span class="mi">160</span><span class="p">,</span> <span class="mi">152</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">159</span><span class="p">,</span> <span class="mi">169</span><span class="p">,</span> <span class="mi">173</span><span class="p">,</span> <span class="mi">203</span><span class="p">,</span> <span class="mi">169</span><span class="p">,</span> <span class="mi">166</span><span class="p">,</span> <span class="mi">162</span><span class="p">,</span> <span class="mi">147</span><span class="p">,</span> <span class="mi">188</span><span class="p">,</span> <span class="mi">161</span><span class="p">,</span> <span class="mi">162</span><span class="p">,</span>
          <span class="mi">169</span><span class="p">,</span> <span class="mi">185</span><span class="p">,</span> <span class="mi">188</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">229</span><span class="p">,</span> <span class="mi">189</span><span class="p">,</span> <span class="mi">218</span><span class="p">,</span> <span class="mi">185</span><span class="p">,</span> <span class="mi">199</span><span class="p">,</span> <span class="mi">210</span><span class="p">,</span> <span class="mi">193</span><span class="p">,</span> <span class="mi">211</span><span class="p">,</span> <span class="mi">208</span><span class="p">,</span> <span class="mi">216</span><span class="p">,</span> <span class="mi">218</span><span class="p">,</span> <span class="mi">264</span><span class="p">,</span> <span class="mi">304</span><span class="p">]</span>
<span class="n">htces_alphas</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">htces_gammas</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">htces_standard_error</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">with</span> <span class="n">mp</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="n">processes</span><span class="o">=</span><span class="n">cores</span><span class="p">)</span> <span class="k">as</span> <span class="n">pool</span><span class="p">:</span>
        <span class="n">htces_forecast</span> <span class="o">=</span> <span class="p">[</span><span class="n">pool</span><span class="o">.</span><span class="n">apply_async</span><span class="p">(</span><span class="n">holts_trend_corrected_exponential_smoothing_forecast</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span><span class="p">(</span><span class="n">orders</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="mi">4</span><span class="p">),</span> <span class="nb">round</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="mi">4</span><span class="p">),</span> <span class="bp">False</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2000</span><span class="p">)]</span>
        <span class="n">htces_results</span> <span class="o">=</span> <span class="p">[</span><span class="n">forecast</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="k">for</span> <span class="n">forecast</span> <span class="ow">in</span> <span class="n">htces_forecast</span><span class="p">]</span>
        <span class="n">htces_alphas</span> <span class="o">=</span> <span class="p">[</span><span class="n">results</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'optimal_alpha'</span><span class="p">,</span> <span class="n">results</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'alpha'</span><span class="p">))</span> <span class="k">for</span> <span class="n">results</span> <span class="ow">in</span> <span class="n">htces_results</span><span class="p">]</span>
        <span class="n">htces_gammas</span> <span class="o">=</span> <span class="p">[</span><span class="n">results</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'optimal_gamma'</span><span class="p">,</span> <span class="n">results</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'gamma'</span><span class="p">))</span> <span class="k">for</span> <span class="n">results</span> <span class="ow">in</span> <span class="n">htces_results</span><span class="p">]</span>
        <span class="n">htces_standard_error</span> <span class="o">=</span> <span class="p">[</span><span class="n">results</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'standard_error'</span><span class="p">,</span> <span class="n">results</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'standard_error'</span><span class="p">))</span> <span class="k">for</span> <span class="n">results</span> <span class="ow">in</span> <span class="n">htces_results</span><span class="p">]</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">Axes3D</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">'alpha'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">'gamma'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s">'SSE'</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">htces_alphas</span><span class="p">,</span> <span class="n">htces_gammas</span><span class="p">,</span> <span class="n">htces_standard_error</span><span class="p">)</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>The random values for the constants generate a spread of results, without any clear indication of “good enough” solutions.</p>

<p><img src="/assets/htces_random_alpha_and_gamma_no_optimisation.png" alt="Holt's Trend Corrected Solution Space" title="solution space" /></p>

<p>Running the solver again, with the optimise flag set to <code class="highlighter-rouge">optimise=True</code>, shows clustering around a ‘good enough’ standard error between 20.9 and 20.1. The results would indicate that the genetic algorithm is working. I will explore how well it is working in another post.</p>

<p><img src="/assets/3D_scatter_plot_holts_trend_corrected_es.png" alt="Holt's Trend Corrected Exponential Smoothing Alpha, Gamma, standard error 3D Plot " title="3D Plot" /></p>


          </div>

  </body>
</html>



    </section>
</div>
</body>





    </div>

  </body>
</html>
